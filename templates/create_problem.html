{% extends "base.html" %}

{% block title %}Create Problem - IOI CMS{% endblock %}

{% block head %}
<!-- CKEditor for rich text editing -->
<script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-plus me-2"></i>Create New Problem
                </h4>
            </div>
            <div class="card-body">
                <form method="POST" id="problemForm">
                    {{ form.hidden_tag() }}
                    
                    <div class="row mb-3">
                        <div class="col-md-8">
                            {{ form.title.label(class="form-label") }}
                            {{ form.title(class="form-control") }}
                            {% if form.title.errors %}
                            <div class="text-danger small">
                                {% for error in form.title.errors %}
                                <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            {{ form.code.label(class="form-label") }}
                            {{ form.code(class="form-control") }}
                            {% if form.code.errors %}
                            <div class="text-danger small">
                                {% for error in form.code.errors %}
                                <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        {{ form.statement.label(class="form-label") }}
                        {{ form.statement(class="form-control", id="statementEditor", rows="10") }}
                        {% if form.statement.errors %}
                        <div class="text-danger small">
                            {% for error in form.statement.errors %}
                            <div>{{ error }}</div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            {{ form.input_format.label(class="form-label") }}
                            {{ form.input_format(class="form-control", rows="4") }}
                            {% if form.input_format.errors %}
                            <div class="text-danger small">
                                {% for error in form.input_format.errors %}
                                <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            {{ form.output_format.label(class="form-label") }}
                            {{ form.output_format(class="form-control", rows="4") }}
                            {% if form.output_format.errors %}
                            <div class="text-danger small">
                                {% for error in form.output_format.errors %}
                                <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        {{ form.constraints.label(class="form-label") }}
                        {{ form.constraints(class="form-control", rows="3") }}
                        {% if form.constraints.errors %}
                        <div class="text-danger small">
                            {% for error in form.constraints.errors %}
                            <div>{{ error }}</div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            {{ form.sample_input.label(class="form-label") }}
                            {{ form.sample_input(class="form-control", rows="4") }}
                            {% if form.sample_input.errors %}
                            <div class="text-danger small">
                                {% for error in form.sample_input.errors %}
                                <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            {{ form.sample_output.label(class="form-label") }}
                            {{ form.sample_output(class="form-control", rows="4") }}
                            {% if form.sample_output.errors %}
                            <div class="text-danger small">
                                {% for error in form.sample_output.errors %}
                                <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-3">
                            {{ form.time_limit.label(class="form-label") }}
                            <div class="input-group">
                                {{ form.time_limit(class="form-control") }}
                                <span class="input-group-text">ms</span>
                            </div>
                            {% if form.time_limit.errors %}
                            <div class="text-danger small">
                                {% for error in form.time_limit.errors %}
                                <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            {{ form.memory_limit.label(class="form-label") }}
                            <div class="input-group">
                                {{ form.memory_limit(class="form-control") }}
                                <span class="input-group-text">MB</span>
                            </div>
                            {% if form.memory_limit.errors %}
                            <div class="text-danger small">
                                {% for error in form.memory_limit.errors %}
                                <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            {{ form.difficulty.label(class="form-label") }}
                            {{ form.difficulty(class="form-select") }}
                            {% if form.difficulty.errors %}
                            <div class="text-danger small">
                                {% for error in form.difficulty.errors %}
                                <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            {{ form.points.label(class="form-label") }}
                            {{ form.points(class="form-control") }}
                            {% if form.points.errors %}
                            <div class="text-danger small">
                                {% for error in form.points.errors %}
                                <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        {{ form.submit(class="btn btn-primary") }}
                        <a href="{{ url_for('admin_problems') }}" class="btn btn-outline-secondary">
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Problem Preview -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-eye me-2"></i>Problem Guidelines
                </h6>
            </div>
            <div class="card-body">
                <h6>Writing Good Problems</h6>
                <ul class="small">
                    <li>Use clear, unambiguous language</li>
                    <li>Provide comprehensive examples</li>
                    <li>Specify all constraints clearly</li>
                    <li>Test with multiple test cases</li>
                    <li>Consider edge cases</li>
                </ul>
                
                <h6 class="mt-3">Problem Code</h6>
                <p class="small text-muted">
                    Use short, memorable codes like A, B, C or A1, B2, etc.
                </p>
                
                <h6 class="mt-3">Time Limits</h6>
                <ul class="small">
                    <li>Easy problems: 1000ms</li>
                    <li>Medium problems: 2000ms</li>
                    <li>Hard problems: 3000-5000ms</li>
                </ul>
            </div>
        </div>

        <!-- Sample Format -->
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-code me-2"></i>Sample Format
                </h6>
            </div>
            <div class="card-body">
                <h6>Input Format Example:</h6>
                <pre class="small bg-light p-2">The first line contains an integer n.
The second line contains n integers.</pre>
                
                <h6 class="mt-3">Output Format Example:</h6>
                <pre class="small bg-light p-2">Print the sum of all integers.</pre>
                
                <h6 class="mt-3">Constraints Example:</h6>
                <pre class="small bg-light p-2">1 ≤ n ≤ 1000
1 ≤ each integer ≤ 10^9</pre>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}

<script>
let statementEditor = null;
document.addEventListener('DOMContentLoaded', function() {
    ClassicEditor
                ]
            }
        })
        .then(editor => {
            statementEditor = editor;
            console.log('CKEditor initialized successfully');
        })
        .catch(error => {
            console.error('CKEditor initialization failed:', error);
        });
    
    // Form submission handler (CKEditor automatically syncs content)
    // Form submission handler
    document.getElementById('problemForm').addEventListener('submit', function(e) {
        // CKEditor automatically syncs content to the textarea
        if (statementEditor) {
            // Get content from CKEditor and set it to the hidden textarea
            const editorContent = statementEditor.getData();
            document.querySelector('#statementEditor').value = editorContent;
            console.log('CKEditor content synced:', editorContent);
        }
        console.log('Form submitted');
        // Let the form submit normally
        return true;
    });
});
</script>
{% endblock %}
